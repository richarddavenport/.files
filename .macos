#! /usr/bin/env zsh

echo "Running .macos script..."

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

# Close any open System Preferences panes, to prevent them from overriding
# settings weâ€™re about to change
osascript -e 'tell application "System Preferences" to quit'

echo "Installing Xcode command line tools..."
sudo xcode-select --install
sudo xcodebuild -license accept

echo "Updating macOS..."
sudo softwareupdate -i -a

for file in ./macos/.*; do
	if [ -f $file ]
	then
		echo "Applying $file"
		source $file
	fi
done

# Kill affected applications
for app in "Activity Monitor" \
	"Address Book" \
	"Calendar" \
	"cfprefsd" \
	"Contacts" \
	"Dock" \
	"Finder" \
	"Mail" \
	"Messages" \
	"Photos" \
	"Safari" \
	"SystemUIServer" \
	"iCal"; do
	killall "${app}" &> /dev/null
done

echo "Done with .macos script..."
